LIST_BOX_CLOSE=-1;function forwardMenu(){var forward=$("#forward").val();var defaultForward="send";if(forward==null){return;}if(forward==""){forward=defaultForward;}if(isSmartPhone&&forward!="viewService"){$(".current").removeClass(".current");$(".selected").css("display","none").removeClass("selected");$(".snav").addClass("current").addClass("selected").show();return;}var dest=$("."+forward);if(dest.length==0){location.href=$.constants.url.notFound;return;}var nextCurrent=null;var url="/main/";if(forward=="viewService"){nextCurrent=$(".toWeb");url+=$("#service").val();}else{nextCurrent=$(".snav a[href = '"+forward+"']").parent("li");url+=forward;}showPage(dest,nextCurrent,url);}function changeMenu(){$(".snav a").off("click");$(".snav a").on("click",function(){var nextCurrent=$(this).parent("li");var dest=$("."+$(this).attr("href"));var url="/main/"+$(this).attr("href");showPage(dest,nextCurrent,url);return false;});}function showPage(dest,nextCurrent,url,form){$(".current").removeClass("current");nextCurrent.addClass("current");$(".selected").fadeOut(0);$(".selected").removeClass("selected");loadPage(dest,url,form);return false;}function loadPage(destination,url,form){showLoading();var param=null;if(form!=null){param=form.serializeArray();}destination.load(url,param,function(responseText,status,XMLHttpRequest){if(status=="success"){destination.fadeIn("fast");destination.addClass("selected");}else{if(status=="error"){if(XMLHttpRequest.status=="401"){location.href=$.constants.url.sessionTimeOutError;}else{location.href=$.constants.url.internalServerError;}}}hideLoading();afterLoadActivity(url,responseText);if(destination.selector==".viewService"){initServiceFunction();}else{initFunction();}$("html, body").animate({scrollTop:0},0);});}function afterLoadActivity(url,responseText){if(url=="/main/mailDetailSet"){if(responseText.indexOf('<div class="errorarea"><p class="txterror">')!=-1){$(".mail_home").hide();$(".mail_setting").show();$("#"+$("#js_target").val()).show();$("html, body").animate({scrollTop:0},0);}}else{if(url=="/main/mailDetail"){$(".mail_home").hide();$(".mail_setting").show();$("#"+$("#js_target").val()).show();$("html, body").animate({scrollTop:0},0);}else{if(url=="/main/deleteMailUser"){if(responseText.indexOf('{"result":true,"url":"/main/menu"}')!=-1){showPage($(".web"),$(".toWeb"),"/main/web/");}}else{if(url.indexOf("/main/web")!==-1||url.indexOf("Release")!==-1){var checkCount=0;var img=$(".web td.lc").find("span");for(var i=0;i<img.length;i++){if(img.eq(i).hasClass("on")){checkCount++;}}var existAllMinServicesArray=$.constants.parameters.deviceIdModelRelationServiceMin.split(",");var existMinServiceFlg=false;var minCheckLimit=0;$.each(existAllMinServicesArray,function(){var existModelId=this.substr(0,this.indexOf("|"));if($("#modelId").val()==existModelId){existMinServiceFlg=true;minCheckLimit=this.split("|").pop();return;}});if(existMinServiceFlg&&checkCount<minCheckLimit){var message=$.constants.messages.underServiceNumMessage.replace("{0}",minCheckLimit);$(".resultMessage").html(message);$("#resultMessageDialog").dialog(modalOption(null));}}}}}}function viewService(){$(".service_setting").off("click");$(".service_setting").on("click",function(event){var url="/main/"+this.id+"Setting";showPage($(".viewService"),$(".toWeb"),url);});}function initFunction(){if(typeof window.addEventListener=="undefined"&&typeof document.getElementsByClassName=="undefined"){ie8BackgroundResizeSettings();}clickAccordion();modalEvent();submitForm();sort();viewService();serviceMenu();checkBoxAndRadioButtonSettings();$("#cas .main .send tr:nth-child(2n) td, #cas .main .web tr:nth-child(2n) td").removeClass("secondColour");$("#cas .main .send tr:nth-child(2n+1) td, #cas .main .web tr:nth-child(2n+1) td").addClass("secondColour");}function initServiceFunction(){if(typeof window.addEventListener=="undefined"&&typeof document.getElementsByClassName=="undefined"){ie8BackgroundResizeSettings();}var now=$("#service").attr("class");if(isTabletOrSmartPhone){openListBoxTrigger();$("#service select").css("display","none");}serviceMenu();if(now=="cig"){if(isSmartPhone){shapeAlbumSetting();}$(".cig_select").customSelect();resizeSelectBox();if(!isSmartPhone){resizeAlbumSelectBox();}cigMenu();max=$.constants.parameters.cigCommentMax;if($("#resultCig").val()!=void 0&&$("#resultCig").val().length>0){var resArray=$("#resultCig").val().split(",");for(var i=0;i<resArray.length;i++){$("#sortable_cig").append(document.getElementById(resArray[i]));}$("#sortable_cig tbody").sortable({disabled:true,update:function(event,ui){$("#resultCig").val($("#sortable_cig tbody").sortable("toArray").toString());}});}$(window).resize(function(){resizeSelectBox();});}if(now=="facebook"){if(isSmartPhone){shapeFacebookTimelineSetting();shapeAlbumSetting();}$(".facebook_group_select").customSelect();resizeSelectBox();facebookMenu();viewCigAlbumOpenSetting();max=$.constants.parameters.facebookCommentMax;if($("#resultFacebook").val()!=void 0&&$("#resultFacebook").val().length>0){var resArray=$("#resultFacebook").val().split(",");for(var i=0;i<resArray.length;i++){$("#facebookgroup").append(document.getElementById(resArray[i]));}$("#facebookgroup tbody").sortable({disabled:true,update:function(event,ui){$("#resultFacebook").val($("#facebookgroup tbody").sortable("toArray").toString());}});}$(window).resize(function(){resizeSelectBox();});}if(now=="twitter"){max=$.constants.parameters.twitterCommentMax;}if(now=="youtube"){$(".youtube_category_select").customSelect();if(!isSmartPhone){resizeYouTubeCategorySelectBox();}viewCigAlbumOpenSetting();max=$.constants.parameters.youtubeCommentMax;$(window).resize(function(){resizeSelectBox();});}if(now=="flickr"){viewCigAlbumOpenSetting();max=$.constants.parameters.flickrCommentMax;}if(now=="googleDrive"){viewCigAlbumOpenSetting();max=$.constants.parameters.googledriveCommentMax;}if(now=="irista"){viewCigAlbumOpenSetting();if($("[name='iristaSettings.notUserExceptionFlg']").val()=="true"){showResultMessage($.constants.messages.iristaNotUserExceptionMessage);}$(".irista_identityProvider_select").customSelect();}if(now=="email"){mailMenu();max=$.constants.parameters.mailCommentMax;}if(now=="imageSync"){if($("#cigCheck").prop("checked")){$(".cas_cloud_setting_cig_setting").show();}if($("#flickrCheck").prop("checked")){$(".cas_cloud_setting_flickr_setting").show();}if($("#googleDriveCheck").prop("checked")){$(".cas_cloud_setting_google_drive_setting").show();}if($("#iristaCheck").prop("checked")){$(".cas_cloud_setting_irista_setting").show();}checkImageSync();checkOncheckService();}if(now=="irista cloudSyncRelation"){if($("[name='iristaSettings.notUserExceptionFlg']").val()=="true"){showResultMessage($.constants.messages.iristaNotUserExceptionMessage);}$(".irista_identityProvider_select").customSelect();}fitSmallButtonToLargeButton();$("#js_comment").bind("input keyup",function(e){var words=$(this).val().replace(/\r?\n|\r/g," ").length;$("#js_count").text(max-words);if(words==0){$("#js_count").text(max);}}).blur(function(){var words=$(this).val().replace(/\r?\n|\r/g," ").length;$("#js_count").text(max-words);if(words==0){$("#js_count").text(max);}});$.js.service.clearSend();if($("#js_comment").val()!=null){var words=$("#js_comment").val().replace(/\r?\n|\r/g," ").length;if(words==0){$("#js_count").text(max);}else{$("#js_count").text(max-words);}}$.js.service.exam();checkBoxAndRadioButtonSettings();$("#service div.small table tr:nth-child(2n+1) td").addClass("secondColour");}function clickCheckBoxBefore(clickObj){var checkLimit=parseInt($("#serviceNum").val());var checkCount=0;var img=$(".web td.lc").find("span");for(var i=0;i<img.length;i++){if(img.eq(i).hasClass("on")){checkCount++;}}if($(clickObj).hasClass("on")){var existAllMinServicesArray=$.constants.parameters.deviceIdModelRelationServiceMin.split(",");var existMinServiceFlg=false;var minCheckLimit=0;$.each(existAllMinServicesArray,function(){var existModelId=this.substr(0,this.indexOf("|"));if($("#modelId").val()==existModelId){existMinServiceFlg=true;minCheckLimit=this.split("|").pop();return;}});if(existMinServiceFlg&&checkCount<=minCheckLimit){var message=$.constants.messages.underServiceNumMessage.replace("{0}",minCheckLimit);$(".resultMessage").html(message);$("#resultMessageDialog").dialog(modalOption(null));return false;}else{$("[name='click_service']").remove();$("<input>").attr({type:"hidden",name:"click_service",value:$(clickObj).attr("id")}).appendTo("#DiplayCamera");$("[name='click_displayCameraFlg']").remove();$("<input>").attr({type:"hidden",name:"click_displayCameraFlg",value:$.constants.parameters.flgOff}).appendTo("#DiplayCamera");return true;}}else{if(checkCount>checkLimit-1){var message=$.constants.messages.overServiceNumMessage.replace("{0}",checkLimit);$(".resultMessage").html(message);$("#resultMessageDialog").dialog(modalOption(null));return false;}else{$("[name='click_service']").remove();$("<input>").attr({type:"hidden",id:"click_service",name:"click_service",value:$(clickObj).attr("id")}).appendTo("#DiplayCamera");$("[name='click_displayCameraFlg']").remove();$("<input>").attr({type:"hidden",id:"click_displayCameraFlg",name:"click_displayCameraFlg",value:$.constants.parameters.flgOn}).appendTo("#DiplayCamera");return true;}}}function toggleCmaeraDisplayIcon(clickObj){if($(clickObj).hasClass("on")){$(clickObj).removeClass("on").addClass("off");}else{$(clickObj).removeClass("off").addClass("on");}}function clickAccordion(){$(".accordion").off("click");$(".accordion").on("click",function(event){var target=$(this).next(".accordionContent");if(target.is(":visible")){$(this).removeClass("open").addClass("close");}else{$(this).removeClass("close").addClass("open");}target.slideToggle();});}function modalOption(message,modal){if(modal===undefined){modal=true;}return{text:message,width:"90%",minHeight:0,dialogClass:"kkkkyDialog",draggable:false,modal:modal,resizable:false,buttonLabel:[$.constants.messages.cancelMessage,$.constants.messages.okMessage],open:function(){$(".kkkkyDialog").focus();$(".kkkkyDialog").blur();$(".ui-dialog-titlebar").hide();$(this).next(".ui-widget-overlay").css("z-index",$(this).attr("z-index")-1);var dialog=$(this).parents(".ui-dialog");if(isSmartPhone){dialog.css("position","absolute");dialog.css("left","5%");dialog.css("top",$(window).scrollTop()+($(window).innerHeight()-dialog.height())/2);}else{dialog.css("left",0);}dialog.css("margin","0 auto");}};}function adjustDialogPosition(targetElem){var innerDivHeight=targetElem.innerHeight();var targetPositionY=($(window).height()-innerDivHeight)/2;targetElem.css("top",targetPositionY);}function submitFormBefore($form,clickObj){resetKkkkyRequestDialog();$(".selected .errorarea").empty();if($form.hasClass("valid-email")){$eMailAddress=$form.find(":input[name=eMailAddress]");checkEMailAddress($eMailAddress,true);}if($form.hasClass("valid-yourNickname")){nickname=$form.find(":input[name=nickname]");checkNickname(nickname,true,true);}if($form.hasClass("valid-sharingNickname")){nickname=$form.find(":input[name=nickname]");checkNickname(nickname,false,true);}if($form.hasClass("valid-nicknames")){$(".nicknames").each(function(){checkNickname($(this),false,false);});}if($form.attr("id")=="kkkkyRequestForm"){var message=$form.attr("data-confirmMessage-template");message=message.replace("{0}",$(":input[name=eMailAddress]").val());$form.attr("data-confirmMessage",message);}if($form.attr("id")=="setNicknameForm"){var message=$form.attr("data-confirmMessage-template");message=message.replace("{0}",$form.find(":input[name=nickname]").val());$form.attr("data-confirmMessage",message);}if($form.attr("action").indexOf("saveDisplayCameraFlg")!=-1){if(!clickCheckBoxBefore(clickObj)){throw"exit";}return;}if($form.attr("action").indexOf("changeDisplayOrder")!=-1){$("[name='result']").remove();$("<input>").attr({type:"hidden",name:"result",value:$("#sortable tbody").sortable("toArray").toString()}).appendTo("#SnsSort");return;}}function submitForm(){$(".submit").off("click");$(".submit").on("click",function(event){var $form=$(this).parents("form");var clickObj=this;if(!$(this).hasClass("dontCloseBeforeSubmit")){closeDialog($(this));}try{submitFormBefore($form,this);}catch(e){return;}if($form.hasClass("confirm")){setShowConfirmDialog($form.attr("data-confirmMessage"),function(){excuteAjax($form,clickObj);});}else{excuteAjax($form,clickObj);}});return false;}function excuteAjax($form,clickObj){showLoading();$.ajax({url:$form.attr("action"),type:$form.attr("method"),data:$form.serialize(),dataType:"json",success:function(data){hideLoading();if(data.result){if($form.dialog("isOpen")){$form.dialog("close");closeDialog($form);}if($form.attr("action").indexOf("releaseDevice")==-1){submitFormAfter($form,clickObj,data.url);}}else{$(":input[name="+data.paramName+"]").addClass("formerror");}if($form.attr("action").indexOf("releaseDevice")!=-1){$("#logoutMessageDialog .gotoIimsTop").attr("href",data.url);showLogoutMessage(data.message);}else{showResultMessage(data.message);}},error:function(XMLHttpRequest,textStatus,errorThrown){if(XMLHttpRequest.status=="401"){location.href=$.constants.url.sessionTimeOutError;}else{if(XMLHttpRequest.status=="404"){location.href=$.constants.url.notFound;}else{location.href=$.constants.url.internalServerError;}}}});}function submitFormAfter($form,clickObj,url){if($form.attr("action").indexOf("kkkkyst")!=-1){$(window).scrollTop(0);showPage($(".kycl"),$(".toKycl"),"/kkkkyst/");$form.find("input").val("");return;}if($form.attr("action").indexOf("saveDisplayCameraFlg")!=-1){toggleCmaeraDisplayIcon(clickObj);return;}if($form.attr("action").indexOf("checkEachServiceCommonSetting")!=-1){loadPage($(".viewService"),url,null);return;}if($form.attr("action").indexOf("changeDisplayOrder")!=-1){$("#changeDisplayOrder").hide();$("#sortOn").show();$("#sortable tbody").css("cursor","auto");$("#sortable tbody").sortable({disabled:true});$("#cas .mc .main .web tr").removeClass("sort");$("#cas .mc .main .web td.fc img").show();$("#cas .mc .main .web td.det a").show();$("#cas .mc .main .web td.lc span").show();$("#cas .main .web tr:nth-child(2n) td").removeClass("secondColour");$("#cas .main .web tr:nth-child(2n+1) td").addClass("secondColour");return;}if(url!=void 0&&url!=""){location.href=url;showLoading();}}function modalEvent(){$(".kkkkyConfirm").off("click");$(".kkkkyConfirm").on("click",function(){var counter=$(this).attr("data-counter");$("#confirmDialog [name='cnt']").val(counter);var actionKind=$(this).attr("data-action");var message=$(this).attr("data-message");setConfirmDialog("","/kkkkyst/"+actionKind+"/","post","kkkkystForm",message);});$(".kkkkyRequest").off("click");$(".kkkkyRequest").on("click",function(){if(!$(this).hasClass("disable")){$("#kkkkyRequestForm").dialog(modalOption(null));}});$(".openSetNicknameModal").off("click");$(".openSetNicknameModal").on("click",function(){if(!$(this).hasClass("disable")){$("#setNicknameForm .formerror").removeClass("formerror");$("#setNicknameDialog").find("[name=cnt]").val($(this).attr("data-counter"));var text=$("#setNicknameDialog .nicknameSettingDescription").attr("data-text-template").replace("{0}",$(this).attr("data-emailAddress"));$("#setNicknameDialog .nicknameSettingDescription").text(text);$("#setNicknameDialog").dialog(modalOption(null));}});$(".mainAction").off("click");$(".mainAction").on("click",function(){var actionKind=$(this).attr("data-action");var message=$(this).attr("data-message");setConfirmDialog("",actionKind+"/","post","MainForm",message);});}function setConfirmDialog(id,action,method,_class,message){$("#confirmDialog").children("form").attr("id",id).attr("action",action).attr("method",method).addClass(_class);$("#confirmDialog .confirmMessage").html(message);$("#confirmDialog").dialog(modalOption(null));}function setShowConfirmDialog(message,okFunc,cancelFunc){$("#confirmShowDialog .confirmMessage").html(message);$("#confirmShowDialog .cancelConfirm").die("click");if(cancelFunc!==undefined){$("#confirmShowDialog .cancelConfirm").live("click",function(){closeDialog($(this));cancelFunc();});}else{$("#confirmShowDialog .cancelConfirm").live("click",function(){closeDialog($(this));return false;});}$("#confirmShowDialog .okConfirm").die("click");if(okFunc!==undefined){$("#confirmShowDialog .okConfirm").live("click",function(){closeDialog($(this));okFunc();});}else{$("#confirmShowDialog .okConfirm").live("click",function(){closeDialog($(this));return false;});}$("#confirmShowDialog").dialog(modalOption(null));}function hideShowConfirmDialog(){closeDialog($("#confirmShowDialog .cancelConfirm"));}function closeDialog(cancelButton){$dialog=$(cancelButton).parents(".ui-dialog");$dialog.dialog("destroy");$dialog.remove();}function resetKkkkyRequestDialog(){$("#kkkkyRequestForm .txterror").remove();$("#kkkkyRequestForm .formerror").removeClass("formerror");}function clearFormInputs(closeButton){var $form=closeButton.parents("form");$form.find(".txterror").remove();$form.find(".formerror").removeClass("formerror");$form.find("input").val("");}function addNotification(type,message){var notificationDiv=$("<div>",{text:message}).addClass("notification "+type);$(".notificationList").append(notificationDiv);}function pre(now){var dpr="x1";if(window.devicePixelRatio<=1){dpr="x1";preloadFunc("/img/"+dpr+"/camera_on_R.png","/img/"+dpr+"/camera_off_R.png","/img/"+dpr+"/gray_button_R.png","/img/"+dpr+"/closed_accordion_N.png","/img/"+dpr+"/open_accordion_N.png");}else{if(window.devicePixelRatio>1&&window.devicePixelRatio<=2){dpr="x2";}else{if(window.devicePixelRatio>2){dpr="x3";}}}preloadFunc("/img/"+dpr+"/wait_black.gif","/img/"+dpr+"/no_check_N.png","/img/"+dpr+"/checked_N.png");}function preloadFunc(){for(var i=0;i<arguments.length;i++){$("<img>").attr("src",arguments[i]);}}function sort(){if($("#result").val()!=void 0&&$("#result").val().length>0){var resArray=$("#result").val().split(",");for(var i=0;i<resArray.length;i++){$("#sortable").append(document.getElementById(resArray[i]));}$("#sortable").sortable({disabled:true,update:function(event,ui){$("#result").val($("#sortable").sortable("toArray").toString());}});}}function sortOn(){$("#sortOn").hide();$("#changeDisplayOrder").show();$("#sortable tbody").css("cursor","move");sortFunc($("#sortable tbody"));$("#cas .mc .main .web tr").addClass("sort");$("#cas .main .web tr:nth-child(2n+1) td").removeClass("secondColour");}function sortFunc($sortElement){if(!isSmartPhone){$sortElement.find("td").addClass("sortHandle");}$sortElement.sortable({disabled:false,axis:"y",handle:".sortHandle",helper:function(e,tr){var $originals=tr.children();var $helper=tr.clone();$helper.children().each(function(index){$(this).width($originals.eq(index).width());$(this).parents("tr").height("auto");if($(this).hasClass("displayName")){$(this).width("inherit");}});return $helper;}});}function Exception($object,message){this.object=$object;this.message=message;this.toString=function(){return this.object.val()+" : "+this.message;};}function addValidationErrorMessageOnly(exception){$(".selected .errorarea").append("<p class='txterror'>"+exception.message+"</p>");}function addValidationErrorMessage(exception){$(".selected .errorarea").append("<p class='txterror'>"+exception.message+"</p>");exception.object.addClass("formerror");}function showValidationErrorDialog(exception){showResultMessage(exception.message);exception.object.addClass("formerror");}function checkEMailAddress($eMailAddress,isDialog){try{if($eMailAddress.val().length==0){throw new Exception($eMailAddress,$.constants.messages.emptyEmailAddressMessage);}if($eMailAddress.val().length>parseInt($.constants.parameters.emailAddressMaxLength)){var max=parseInt($.constants.parameters.emailAddressMaxLength);throw new Exception($eMailAddress,$.constants.messages.overMaxLengthEmailAddressMessage.replace("{0}",max));}if(!$eMailAddress.val().match(/^([a-zA-Z0-9])+([a-zA-Z0-9\._-])*@([a-zA-Z0-9_-])+([a-zA-Z0-9\._-]+)+$/)){throw new Exception($eMailAddress,$.constants.messages.invalidEmailAddressMessage);}}catch(e){if(isDialog){showValidationErrorDialog(e);}else{addValidationErrorMessage(e);}throw e;}}function checkNickname(nickname,isYourNickname,isDialog){try{nickname.val(nickname.val().replace(/(^\s+)|(\s+$)/g,""));var byteLength=getByte(nickname.val());var min=parseInt($.constants.parameters.nicknameMinLength);var max=parseInt($.constants.parameters.nicknameMaxLength);if(byteLength<=min&&!isYourNickname){throw new Exception(nickname,$.constants.messages.onesNickNameNotEntered);}else{if(byteLength>max){if(isYourNickname){throw new Exception(nickname,$.constants.messages.yourNickNameLengthIsTooLong.replace("{0}",max));}else{throw new Exception(nickname,$.constants.messages.onesNickNameLengthIsTooLong.replace("{0}",max));}}}}catch(e){if(isDialog){showValidationErrorDialog(e);}else{addValidationErrorMessage(e);}throw e;}}function getByte(str){var byteLength=0;for(var i=0;i<str.length;i++){charByte=encodeURIComponent(str.charAt(i)).match(/%/g);if(charByte==null||charByte==""||charByte==0){byteLength+=1;}else{byteLength+=charByte.length;}}return byteLength;}function showResultMessage(message,callback){if(message==null||message==""){return;}var btnElement=document.getElementById("resultOk");if(callback===undefined){btnElement.onclick=function(){closeDialog($(this));return false;};}else{btnElement.onclick=function(){closeDialog($(this));callback();};}$(".resultMessage").html(message);$("#resultMessageDialog").dialog(modalOption(null));}function showLogoutMessage(message){if(message==null||message==""){return;}$(".logoutMessage").html(message);$("#logoutMessageDialog").dialog(modalOption(null));}function showLoading(){if(!isTabletOrSmartPhone){var userAgent=window.navigator.userAgent.toLowerCase();if(userAgent.indexOf("chrome")!=-1||userAgent.indexOf("firefox")!=-1){$(":focus").blur();}else{$(".menu").focus();$(".menu").blur();}}$(".ui-widget-overlay").hide();adjustDialogPosition($(".loading").find(".dialogInnerDiv"));$(".loading").show();}function hideLoading(){$(".ui-widget-overlay").show();$(".loading").fadeOut("normal");}function toggleHeaderMenu(){var $menu=$("#header .p_pop");$(".headerMenu").off("click");$(".headerMenu").on("click",function(){$menu.fadeToggle("fast");$("#cover").show();});$("#cover").off("click");$("#cover").on("click",function(){$("#cover").hide();$menu.fadeOut("fast");});}function serviceMenu(){$("a.web_service").off("click");$("a.web_service").on("click",function(){var dest=$(this);var target=$("."+dest.attr("href"));showPage($(target),$(".toWeb"),"/main/"+dest.attr("href"));return false;});$("a.service").off("click");$("a.service").on("click",function(){var $form=$("#MainForm");$form.attr("action","/main/"+this.id);try{updateService($form);}catch(e){}return false;});$("a.service_update_facebook").off("click");$("a.service_update_facebook").on("click",function(){var $form=$("#MainForm");$form.attr("action","/main/"+this.id);var messagePostFlg=false;var messageOverAccountFlg=false;var messagePost="";var messageOverAccount="";var message="";if($("#C_0").attr("checked")=="checked"||$("#C_1").attr("checked")=="checked"){messagePostFlg=true;messagePost=$.constants.messages.facebookPostsWideMessage;}if($("#isPcApp").val()!="true"){var fbWallLength=$(".ipt_facebookgroup tr input[type='checkbox']:checked").length;var fbGroupLength=0;$("table#facebookgroup tbody tr").each(function(i,group){var $groupSelect=$(group).find("select").find("option:selected").val();var $groupText=$(group).find("input:text");if($groupSelect!=""&&$groupText.val().length!=0){fbGroupLength++;}});var fbLength=fbWallLength+fbGroupLength;if($("#shareFlg").val()=="true"&&fbLength>parseInt($("#webAccountNum").val())){messageOverAccountFlg=true;messageOverAccount=$.constants.messages.facebookOverWebAccountNumMessage.replace("{0}",parseInt($("#webAccountNum").val()));messageOverAccount=messageOverAccount.replace("{0}",parseInt($("#webAccountNum").val()));}}if(messagePostFlg&&messageOverAccountFlg){setShowConfirmDialog(messagePost,function(){setShowConfirmDialog(messageOverAccount,function(){try{updateService($form);}catch(e){return;}});});}else{if(messagePostFlg||messageOverAccountFlg){if(messagePostFlg){message=messagePost;}else{if(messageOverAccountFlg){message=messageOverAccount;}}setShowConfirmDialog(message,function(){try{updateService($form);}catch(e){return;}});}else{try{updateService($form);}catch(e){}}}return false;});$("a.service_update_cig").off("click");$("a.service_update_cig").on("click",function(){var $form=$("#MainForm");$form.attr("action","/main/"+this.id);var messageOverAccountFlg=false;var messageOverAccount="";if($("#isPcApp").val()!="true"){var cigLibraryLength=$("input[type='checkbox']#cigSettings\\.libraryFlg:checked").length;var cigAlbumLength=0;$("table#sortable_cig tbody tr").each(function(i,album){var $albumSelect=$(album).find("select").find("option:selected").val();var $albumText=$(album).find("input:text");if($albumSelect!=""&&$albumText.val().length!=0){cigAlbumLength++;}});var cigLength=cigAlbumLength+cigLibraryLength;if($("#shareFlg").val()=="true"&&cigLength>parseInt($("#webAccountNum").val())){messageOverAccountFlg=true;messageOverAccount=$.constants.messages.cigOverWebAccountNumMessage.replace("{0}",parseInt($("#webAccountNum").val()));messageOverAccount=messageOverAccount.replace("{0}",parseInt($("#webAccountNum").val()));}}if(messageOverAccountFlg){setShowConfirmDialog(messageOverAccount,function(){try{updateService($form);}catch(e){return;}});}else{try{updateService($form);}catch(e){}}return false;});$("a.service_update_mail").off("click");$("a.service_update_mail").on("click",function(){var $form=$("#MainForm");$form.attr("action","/main/"+this.id);var messageOverAccountFlg=false;var messageOverAccount="";if($("#isPcApp").val()!="true"){var mailSendLength=parseInt($("#mail_settings_size").val());if($("#shareFlg").val()=="true"&&mailSendLength>parseInt($("#accountNum").val())){messageOverAccountFlg=true;messageOverAccount=$.constants.messages.mailOverWebAccountNumMessage.replace("{0}",parseInt($("#accountNum").val()));messageOverAccount=messageOverAccount.replace("{0}",parseInt($("#accountNum").val()));}}if(messageOverAccountFlg){setShowConfirmDialog(messageOverAccount,function(){try{updateService($form);}catch(e){return;}});}else{try{updateService($form);}catch(e){}}return false;});$("a.serviceAuth").off("click");$("a.serviceAuth").on("click",function(){var $form=$("#MainForm");$form.attr("action","/main/"+this.id);var facebookAuth="facebookAuth";if(this.id==facebookAuth){$("#isPC").val(!isTabletOrSmartPhone);}if(!isTabletOrSmartPhone&&this.id==facebookAuth){var windowOpenFailedAlert=function(){userAgent=navigator.userAgent;if(userAgent.indexOf("Safari")!=-1&&userAgent.indexOf("Chrome")==-1){$(".resultMessage").html($.constants.messages.popupBlockMessage);$("#resultMessageDialog").dialog(modalOption(null));}};$.ajax({type:"POST",url:"/main/"+this.id,data:$form.serialize(),success:function(response){var subWindow=window.open($("#authUrl").val());if(subWindow==null){windowOpenFailedAlert();}hideLoading();}});showLoading();}else{$form.submit();showLoading();}});$("a.serviceRelease").off("click");$("a.serviceRelease").on("click",function(){var url="/main/"+this.id;setShowConfirmDialog($(this).attr("data-confirmMessage"),function(){var form=$("#MainForm").attr("action",url);var dest;if($("#service").hasClass("cloudSyncRelation")){dest=$(".viewService");}else{dest=$(".web");}showPage(dest,$(".toWeb"),url,form);});});$(".service_confirm").off("click");$(".service_confirm").on("click",function(){var actionKind=$(this).attr("data-action");var message=$(this).attr("data-message");setConfirmDialog("",actionKind+"/","post","MainForm",message);});$(".service_submit").off("click");$(".service_submit").on("click",function(event){var $form=$(this).parents("form");var clickObj=this;setShowConfirmDialog($form.attr("data-confirmMessage"),function(){excuteAjax($form,clickObj);});});$(".service_common + label").off("click");$(".service_common + label").toggle(function(){useCommonSettingCheckFunction(this);},function(){useCommonSettingCheckFunction(this);});$("a.service_to_service").off("click");$("a.service_to_service").on("click",function(){var action="/main/"+this.id;var $form=$(this).parents("form");$(".selected").fadeOut("fast");$(".selected").removeClass("selected");loadPage($(".viewService"),action,$form);});}useIndividualSetting=function($form,serviceName,actionKind,isOK){$form.attr("action",actionKind+"/"+serviceName+"/"+isOK+"/");showLoading();$.ajax({url:$form.attr("action"),type:$form.attr("method"),data:$form.serialize(),dataType:"json",success:function(data){hideLoading();hideShowConfirmDialog();if(data.result){if(data.message!==undefined){showResultMessage(data.message,function(){loadPage($(".viewService"),data.url,null);return false;});}else{loadPage($(".viewService"),data.url,null);}}else{$(":input[name="+data.paramName+"]").addClass("formerror");}},error:function(XMLHttpRequest,textStatus,errorThrown){if(XMLHttpRequest.status=="401"){location.href=$.constants.url.sessionTimeOutError;}else{location.href=$.constants.url.internalServerError;}}});};function useCommonSettingCheckFunction(obj){var $form=$(obj).prev("input").parents("form");var serviceName=$("#service").attr("class");var actionKind=$(obj).prev("input").attr("data-action");var message=$(obj).prev("input").attr("data-message");var checkedFlg=$(obj).prev("input").prop("checked");if(checkedFlg){setShowConfirmDialog($(obj).prev("input").attr("data-confirmMessage"),function(){hideShowConfirmDialog();setShowConfirmDialog(message,function(){useIndividualSetting($form,serviceName,actionKind,true);},function(){useIndividualSetting($form,serviceName,actionKind,false);});});}else{setConfirmDialog("",actionKind+"/"+serviceName+"/"+false+"/","post","MainForm",message);}if(checkedFlg){$(obj).addClass("checked").prev("input").attr("checked","checked");}else{$(obj).removeClass("checked").prev("input").removeAttr("checked","checked");}}function updateService($form){$.js.service.clearSend();try{}catch(e){throw e;}showLoading();$.ajax({url:$form.attr("action"),type:$form.attr("method"),data:$form.serialize(),dataType:"json",success:function(data){if(data.result){showPage($(".web"),$(".toWeb"),"/main/web/");}else{var className=$("#service").attr("class");var url="/main/"+className+"Setting";loadPage($(".viewService"),url);}},error:function(XMLHttpRequest,textStatus,errorThrown){if(XMLHttpRequest.status=="401"){location.href=$.constants.url.sessionTimeOutError;}else{location.href=$.constants.url.internalServerError;}}});}function loadMoreImages(){var limit=$("#sendHistoryDisplayImageNum").val();var i=0;$(".img_list li:hidden").each(function(){$(this).fadeIn("slow");++i;if(i>=limit){return false;}});if($(".img_list li:hidden").length==0){$(".loadMoreImages").remove();}}function checkBoxAndRadioButtonSettings(){$('input[type="checkbox"]').each(function(){if($(this).attr("checked")=="checked"){$(this).next().addClass("checked");}});$('input[type="checkbox"]:not(.service_common):not(.imageSync):not(:disabled) + label').off("click");$('input[type="checkbox"]:not(.service_common):not(.imageSync):not(:disabled) + label').toggle(function(){if($(this).prev("input").attr("checked")=="checked"){$(this).removeClass("checked").prev("input").removeAttr("checked","checked");}else{$(this).addClass("checked").prev("input").attr("checked","checked");}},function(){if($(this).prev("input").attr("checked")=="checked"){$(this).removeClass("checked").prev("input").removeAttr("checked","checked");}else{$(this).addClass("checked").prev("input").attr("checked","checked");}});$('input[type="radio"]').css({opacity:"0"}).each(function(){if($(this).attr("checked")=="checked"){$(this).next().addClass("checked");}});$('input[type="radio"]:not(:disabled) + label').off("click");$('input[type="radio"]:not(:disabled) + label').on("click",function(){$(this).parent().parent().each(function(){$('input[type="radio"] + label',this).removeClass("checked");});$(this).addClass("checked");});}function checkImageSync(){$('input[type="checkbox"].imageSync + label').off("click");$('input[type="checkbox"].imageSync + label').toggle(function(){checkImageSyncFunction(this);},function(){checkImageSyncFunction(this);});}function checkImageSyncFunction(obj){var setting=$(obj).prev("input").parent().parent().find("div.middle");var original=setting.find("input").eq(0);var small=setting.find("input").eq(1);var id=$(obj).prev("input").parent().find("input").attr("id");if($(obj).prev("input").attr("checked")=="checked"){$(setting).css("display","none");$(original).attr("checked",false);$(original).next().removeClass("checked");$(small).attr("checked",false);$(small).next().removeClass("checked");$(obj).removeClass("checked").prev("input").removeAttr("checked","checked");}else{$(setting).show();if($(original).attr("checked")!="checked"&&$(small).attr("checked")!="checked"){var imageSyncCopyCodeDefault=void 0;if(id.indexOf("cig")!=-1){imageSyncCopyCodeDefault=$.constants.parameters.imageSyncCopyCodeOpaDefault;}else{if(id.indexOf("flickr")!=-1){imageSyncCopyCodeDefault=$.constants.parameters.imageSyncCopyCodeFlickrDefault;}else{if(id.indexOf("googleDrive")!=-1){imageSyncCopyCodeDefault=$.constants.parameters.imageSyncCopyCodeGoogleDriveDefault;}else{if(id.indexOf("irista")!=-1){imageSyncCopyCodeDefault=$.constants.parameters.imageSyncCopyCodeIristaDefault;}}}}if(imageSyncCopyCodeDefault==1){$(small).attr("checked",true);$(small).next().addClass("checked");}else{if(imageSyncCopyCodeDefault==2){$(original).attr("checked",true);$(original).next().addClass("checked");}}}$(obj).addClass("checked").prev("input").attr("checked","checked");}checkOncheckService();}function openListBoxTrigger(){$(".openListBox").off("click");$(".openListBox").on("click",function(){if(!$(this).children(".comboBox").hasClass("disabled")){openListBox($(this).find("select"));}});}function openListBox(target){$(target).blur();document.activeElement.blur();var title=$(target).attr("title");var scrollTop=$(window).scrollTop();var currentVal=null;$(target).children("select option").each(function(){var text=$(this).text();var val=$(this).val();$(".listBox .selectionList").append("<li data-value="+val+">"+text+"</li>");if($(this).prop("selected")){currentVal=val;}});var closeElement="<li data-value='"+LIST_BOX_CLOSE+"'>"+$.constants.messages.closeMessage+"</li>";$(".listBox .selectionList").prepend(closeElement).append(closeElement);$(".listBoxTitle span").text(title);$(".listBox").attr("data-name",$(target).attr("name"));$(".listBox").attr("data-scrollTop",scrollTop);$(".listBox").attr("data-currentVal",currentVal);$("#content").hide();$(".listBox").show();$(".listBox ul.selectionList").height($(window).height()-$(".listBoxTitle").outerHeight());$(".fixedBackground.listBox").width($("body").width()).height($(window).height());$(window).resize(function(){$(".listBox ul.selectionList").height($(window).height()-$(".listBoxTitle").outerHeight());});selectOnListBox();}function selectOnListBox(){$(".selectionList li").off("click");$(".selectionList li").on("click",function(){var listBox=$(this).parents(".listBox");var targetId=listBox.attr("data-name");var scrollTop=listBox.attr("data-scrollTop");var currentVal=listBox.attr("data-currentVal");var val=$(this).attr("data-value");$("#content").show();$(window).scrollTop(scrollTop);if(val!=LIST_BOX_CLOSE&&currentVal!=val){$('select[name="'+targetId+'"] option[value="'+val+'"]').prop("selected",true).change();}listBox.hide();$(".selectionList").empty();$(".listBoxTitle span").text("");});}function validateWebService($form){$(".selected .errorarea").empty();$form.find(".formerror").removeClass("formerror");try{var now=$("#service").attr("class");if(now=="facebook"){validateFacebook($form);}}catch(e){throw e;}}function validateFacebook($form){var countNum=0;var arrayNameList=[];checkComment($form);countNum=checkTimeLine(countNum,arrayNameList);countNum=checkGroup(countNum,arrayNameList);checkPostedCount($form,countNum);if($(".selected .errorarea").children().size()>0){$("html, body").animate({scrollTop:0},0);throw"exit";}}function checkComment($form){var $comment=$form.find("textarea#js_comment");var max=parseInt($.constants.parameters.facebookCommentMax);if($comment.val().length>max){addValidationErrorMessage(new Exception($comment,$.constants.messages.overMaxLengthFacebookCommentMessage.replace("{0}",max)));}if($comment.val().slice(-1)=="_"){addValidationErrorMessage(new Exception($comment,$.constants.messages.endUnderLingFacebookCommentMessage));}}function checkTimeLine(countNum,arrayNameList){$("table.timeline tbody tr").each(function(i,timeline){var $timeLineText=$(timeline).find("input:text");if($(timeline).find("input:checkbox").attr("checked")=="checked"){if($timeLineText.val().length==0){addValidationErrorMessage(new Exception($timeLineText,$.constants.messages.noLengthFacebookTimeLineNameMessage));}countNum++;}var min=parseInt($.constants.parameters.facebookTimeLineNameMin);if($timeLineText.val().length<min){addValidationErrorMessage(new Exception($timeLineText,$.constants.messages.smallerMinLengthFacebookTimeLineNameMessage.replace("{0}",min)));}if($timeLineText.val().match(/[\\p{Print}+]/)){addValidationErrorMessage(new Exception($timeLineText,$.constants.messages.matchPrintableCharactersFacebookTimeLineNameMessage));}for(var i=0;i<arrayNameList.length;++i){if($timeLineText.val()==arrayNameList[i]){addValidationErrorMessage(new Exception($timeLineText,$.constants.messages.sameNameFacebookNameMessage));break;}}arrayNameList.push($timeLineText.val());});return countNum;}function checkGroup(countNum,arrayNameList){var selectList=[];$("table#facebookgroup tbody tr").each(function(i,group){var $groupSelect=$(group).find("select").find("option:selected").val();var $groupText=$(group).find("input:text");if($groupSelect==""&&$groupText.val().length==0){return true;}var $errorSelect=$(group).find(".comboBox");countNum++;for(var i=0;i<selectList.length;++i){if($groupSelect==selectList[i]){addValidationErrorMessage(new Exception($errorSelect,$.constants.messages.sameIdFacebookGroupMessage));break;}}selectList.push($groupSelect);var min=parseInt($.constants.parameters.facebookGroupNameMin);if($groupText.val().length<min){addValidationErrorMessage(new Exception($groupText,$.constants.messages.smallerMinLengthFacbeookGroupNameMessage.replace("{0}",min)));}if($groupText.val().match("\\p{Print}+")){addValidationErrorMessage(new Exception($groupText,$.constants.messages.matchPrintableCharactersFacebookGroupNameMessage));}if($groupSelect==""){addValidationErrorMessage(new Exception($errorSelect,$.constants.messages.noSelectedFacbeookGroupMessage));}if($groupText.val().length==0){addValidationErrorMessage(new Exception($groupText,$.constants.messages.noLengthFacebookGroupNameMessage));}for(var i=0;i<arrayNameList.length;++i){if($groupText.val()==arrayNameList[i]){addValidationErrorMessage(new Exception($groupText,$.constants.messages.sameNameFacebookNameMessage));break;}}arrayNameList.push($groupText.val());});return countNum;}function checkPostedCount($form,countNum){var shareFlg=$form.find("#shareFlg").val();var max=0;if(shareFlg=="true"){max=parseInt($.constants.parameters.deviceAccountMax);}else{max=parseInt($("#webAccountNum").val());}if(countNum>max){addValidationErrorMessageOnly(new Exception(null,$.constants.messages.overMaxFacebookSelectedMessage.replace("{0}",max)));}if(countNum==0){addValidationErrorMessage(new Exception($form.find(".valid-noSelected"),$.constants.messages.noSelectedFacebookMessage));}}function resizeSelectBox(){if(isSmartPhone){var PADDING_WIDTH=65;var PADDING_WIDTH2=135;$(".cigAreaSelect, .youtube_category_select").parents(".comboBoxArea").width($(window).width()-PADDING_WIDTH);$(".cigAlbumSelect, .facebook_group_select").parents(".comboBoxArea").width($(window).width()-PADDING_WIDTH2);$(window).resize(function(){$(".cigAreaSelect, .youtube_category_select").parents(".comboBoxArea").width($(window).width()-PADDING_WIDTH);$(".cigAlbumSelect, .facebook_group_select").parents(".comboBoxArea").width($(window).width()-PADDING_WIDTH2);});}else{var paddingAndBorderSize=22;var selectBoxSize=($("#service div.small").width()-$("#service table .sortOffStyle").outerWidth())/2-paddingAndBorderSize;$("#service table th.resizeTarget").width(selectBoxSize);$("#service table th.resizeTarget").css("max-width",selectBoxSize);$("#service table tr").each(function(i,text){var target=$(text);target.children("td").eq(0).css("max-width",selectBoxSize);});$("#service table .hasCustomSelect").width($("#service table .comboBox").width()+18);}}function getMaxWidth($option){var ruler=$("#ruler");ruler.html("");var maxWidth=null;$option.each(function(){ruler.html($(this).html());if(maxWidth==null||ruler.width()>maxWidth){maxWidth=ruler.width();}});ruler.html("");return maxWidth;}function resizeAlbumSelectBox(){var maxWidth=getMaxWidth($("select#cigSettings\\.cigArea option"));$(".albumSelectComboBox").width(maxWidth-6);$("#cigSettings\\.cigArea").width(maxWidth+27);$(".customSelect.cig_select.sortDisableStyle.cigAreaSelect").width(maxWidth+9);}function resizeYouTubeCategorySelectBox(){var maxWidth=getMaxWidth($("select.youtube_category_select option"));$(".categoryComboBox").width(maxWidth+2);$("select.youtube_category_select").width(maxWidth+35);$(".customSelect.youtube_category_select").width(maxWidth+17);}function fitSmallButtonToLargeButton(){var minWidth=120;var $backButton=null;$(".backButton").each(function(){if($(this).width()>0){$backButton=$(this);}});var $settingButton=null;$(".settingButton").each(function(){if($(this).width()>0){$settingButton=$(this);}});if($backButton!=null&&$settingButton!=null){if($backButton.width()>minWidth||$settingButton.width()>minWidth){if($backButton.width()>$settingButton.width()){$settingButton.width($backButton.width());}else{if($settingButton.width()>$backButton.width()){$backButton.width($settingButton.width());}}}}}function getCookie(cookieName){if(document.cookie.length>0){cookieStart=document.cookie.indexOf(cookieName+"=");if(cookieStart!=-1){cookieStart+=cookieName.length+1;cookieEnd=document.cookie.indexOf(";",cookieStart);if(cookieEnd==-1){cookieEnd=document.cookie.length;}return unescape(document.cookie.substring(cookieStart,cookieEnd));}}return"";}function getParamValue(paramName){var allParams={};if(location.search.length>0){var queryString=location.search.slice(1).split("&");for(var param in queryString){allParams[queryString[param].split("=")[0]]=unescape(queryString[param].split("=")[1]);}return allParams[paramName];}return"";}function commonHeader(){function transition(url){location.href=url;showLoading();}$(".jsMainTop").live("click",function(){transition($.constants.url.mainTop);return false;});$(".jsMainLogout").live("click",function(){transition($.constants.url.mainLogout);return false;});}